{% extends "utils/base.html" %}
{% block title %}{% endblock %}
{% block content %}
<div class="route-page">
    <div class="route-layout">
        {% include "utils/route_display.html" %}
    </div>
</div>

<div class="route-actions">
    <div class="countdown-timer" id="timer-container">
        <div class="timer-header">
            <span>Timer</span>
            <button class="drag-handle">â‰¡</button>
        </div>
        <div id="countdown">Time remaining: <span id="timer"></span></div>
        <div class="timer-controls">
            <button id="startBtn" class="timer-btn">Start</button>
            <button id="stopBtn" class="timer-btn" disabled>Stop</button>
            <button id="resetBtn" class="timer-btn">Reset</button>
        </div>
    </div>
</div>

<script>
    // Initialize countdown timer
    let timeLeft = parseInt('{{ route.duration_seconds }}') || 600;
    let timerInterval = null;
    let isRunning = false;
    const originalTime = timeLeft;

    // Add checkboxes to all tricks
    document.addEventListener('DOMContentLoaded', function() {
        const trickFrames = document.querySelectorAll('.prop-details-frame');
        trickFrames.forEach(frame => {
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'trick-checkbox no-print';
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    frame.classList.add('completed');
                } else {
                    frame.classList.remove('completed');
                }
            });
            frame.querySelector('.trick-content').insertBefore(checkbox, frame.querySelector('.trick-content').firstChild);
        });
    });

    function updateTimer() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        document.getElementById('timer').textContent = 
            minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
        
        if (timeLeft > 0) {
            timeLeft--;
        } else {
            stopTimer();
            document.getElementById('countdown').textContent = "Time's up!";
        }
    }

    function startTimer() {
        if (!isRunning) {
            isRunning = true;
            timerInterval = setInterval(updateTimer, 1000);
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
        }
    }

    function stopTimer() {
        if (isRunning) {
            isRunning = false;
            clearInterval(timerInterval);
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }
    }

    function resetTimer() {
        stopTimer();
        timeLeft = originalTime;
        document.getElementById('countdown').innerHTML = 'Time remaining: <span id="timer"></span>';
        updateTimer();
    }

    // Add event listeners for buttons
    document.getElementById('startBtn').addEventListener('click', startTimer);
    document.getElementById('stopBtn').addEventListener('click', stopTimer);
    document.getElementById('resetBtn').addEventListener('click', resetTimer);

    // Initialize timer display immediately
    updateTimer();
</script>
{% endblock %}